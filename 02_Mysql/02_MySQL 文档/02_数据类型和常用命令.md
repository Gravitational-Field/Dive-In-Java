# 数据类型和常用命令

## 目标

- 数据完整性
- 常用命令
- 数据备份和恢复

## 1. 数据完整性

- **一个数据库**就是一个完整的业务单元，可以**包含多张表**，**数据被存储在表中**
- 在表中为了更加准确的存储数据，保证数据的正确有效，可以在创建表的时候，为表添加一些**强制性的验证，包括数据字段的类型、约束**

### 1.1 数据类型

- 使用数据类型的原则是：够用就行，尽量使用取值范围小的，而不用大的，这样可以更多的节省存储空间

| 类型         | 大小   | 用途            |
| ------------ | ------ | --------------- |
| TINYINT      | 1 字节 | 小整数值        |
| SMALLINT     | 2 字节 | 大整数值        |
| MEDIUMINT    | 3 字节 | 大整数值        |
| INT或INTEGER | 4 字节 | 大整数值        |
| **BIGINT**   | 8 字节 | 极大整数值      |
| FLOAT        | 4 字节 | 单精度 浮点数值 |
| DOUBLE       | 8 字节 | 双精度 浮点数值 |
| DECIMAL      |        | 小数值          |

| 类型      | 大小 (字节) | 格式                | 用途             |
| --------- | ----------- | ------------------- | ---------------- |
| DATE      | 3           | YYYY-MM-DD          | 日期值           |
| TIME      | 3           | HH:MM:SS            | 时间值或持续时间 |
| YEAR      | 1           | YYYY                | 年份值           |
| DATETIME  | 8           | YYYY-MM-DD HH:MM:SS | 混合日期和时间值 |
| TIMESTAMP | 4           | YYYYMMDD            |                  |



| 类型       | 大小                | 用途                            |
| ---------- | ------------------- | ------------------------------- |
| CHAR       | 0-255字节           | 定长字符串                      |
| VARCHAR    | 0-65535 字节        | 变长字符串                      |
| TINYBLOB   | 0-255字节           | 不超过 255 个字符的二进制字符串 |
| TINYTEXT   | 0-255字节           | 短文本字符串                    |
| BLOB       | 0-65 535字节        | 二进制形式的长文本数据          |
| TEXT       | 0-65 535字节        | 长文本数据                      |
| MEDIUMBLOB | 0-16 777 215字节    | 二进制形式的中等长度文本数据    |
| MEDIUMTEXT | 0-16 777 215字节    | 中等长度文本数据                |
| LONGBLOB   | 0-4 294 967 295字节 | 二进制形式的极大文本数据        |
| LONGTEXT   | 0-4 294 967 295字节 | 极大文本数据                    |

CHAR 和 VARCHAR 类型类似，但它们保存和检索的方式不同。它们的最大长度和是否尾部空格被保留等方面也不同。在存储或检索过程中不进行大小写转换。

BLOB 是一个二进制大对象，可以容纳可变数量的数据。有 4 种 BLOB 类型：TINYBLOB、BLOB、MEDIUMBLOB 和 LONGBLOB。它们区别在于可容纳存储范围不同。

有 4 种 TEXT 类型：TINYTEXT、TEXT、MEDIUMTEXT 和 LONGTEXT。对应的这 4 种 BLOB 类型，可存储的最大长度不同，可根据实际情况选择。

### 1.2 约束

- 主键primary key：物理上存储的顺序
- 非空not null：此字段不允许填写空值
- 惟一unique：此字段的值不允许重复
- 默认default：当不填写此值时会使用默认值，如果填写时以填写为准
- **外键foreign key**：对关系字段进行约束，当为关系字段填写值时，会到关联的表中查询此值是否存在，如果存在则填写成功，如果不存在则填写失败并抛出异常
- 说明：虽然 **外键约束** 可以保证数据的有效性，但是在进行数据的crud（增加、修改、删除、查询）时，都会降低数据库的性能，所以**不推荐使用**，那么数据的有效性怎么保证呢？答：可以在逻辑层进行控制

## 2. 常用命令

### 2.1 访问数据库

- 在工作中主要使用命令操作方式，要求熟练编写
- 打开终端，运行命令

```bash
mysql -uroot -p
回车后输入密码，当前设置的密码为mysql
```

- 退出登录

```bash
quit 和 exit
或
ctrl+d
```

### 2.2 操作数据库

- 查看所有数据库

```bash
show databases;
```

- 使用数据库

```bash
use 数据库名;
```

- 查看当前使用的数据库

```sql
select database();
```

- 创建数据库

```sql
create database 数据库名;
例：
create database mydb;
```

- 删除数据库

```sql
drop database 数据库名;
例：
drop database mydb;
```

### 2.3 操作数据表

- 查看当前数据库中所有表

```sql
show tables;
```

- 查看表结构

```sql
desc 表名;
```

- 创建表
- `auto_increment`表示自动增长

```sql
CREATE TABLE table_name(
    column1 datatype contrai,
    column2 datatype,
    column3 datatype,
    .....
    columnN datatype,
    PRIMARY KEY(one or more columns)
);
```

创建班级表

```sql
create table classes(
    id int unsigned auto_increment primary key not null,
    name varchar(10)
);
```

创建学生表

```sql
CREATE TABLE students (
    id  int NOT NULL AUTO_INCREMENT ,
    cls_id  int DEFAULT 0 ,
    name  varchar(20) NOT NULL DEFAULT '' ,
    age  tinyint DEFAULT 0 ,
    height decimal(5,2),
    gender enum('男','女','保密'),
    birthday  date NOT NULL ,
    is_delete  bit DEFAULT 0 ,
    PRIMARY KEY (id)
);
```

- 删除表

```sql
drop table 表名;
例：
drop table students;
```

- 查看表的创建语句

```sql
show create table 表名;
例：
show create table classes;
```

### 2.4 操作数据

#### 查询

- 查询所有列

```sql
select * from 表名;
例：
select * from classes;
```

#### 新增

- 说明：主键列是自动增长，但是在全列插入时需要占位，通常使用0或者 default 或者 null 来占位，插入成功后以实际数据为准
- 全列插入：值的顺序与表中字段的顺序对应

```sql
insert into 表名 values(...)
例：
insert into students values(0,’郭靖‘,1,'蒙古','2016-1-2');
```

- 部分列插入：值的顺序与给出的列顺序对应

```sql
insert into 表名(列1,...) values(值1,...)
例：
insert into students(name,hometown,birthday) values('黄蓉','桃花岛','2016-3-2');
```

#### 修改

```sql
update 表名 set 列1=值1,列2=值2... where 条件
例：
update students set gender=0,hometown='北京' where id=5;
```

#### 删除

```sql
delete from 表名 where 条件
例：
delete from students where id=5;
```

## 3. 备份和恢复

### 备份

- 运行mysqldump命令

```sql
mysqldump –uroot –p 数据库名 > db.sql;

# 按提示输入mysql的密码
```

### 恢复

- 连接mysql，创建新的数据库
- 退出连接，执行如下命令

```sql
mysql -uroot –p 新数据库名 < db.sql
# 根据提示输入mysql密码
```